<% if @current_user.type == 'Customer'%>
    <h1> Your Packages </h1>

    <table class="striped">
      <thead>
        <tr>
          <th data-field="id">Status</th>
          <th data-field="name">Title</th>
          <th data-field="price">Origin</th>
          <th data-field="price">Destination</th>
        </tr>
      </thead>


      <tbody>
        <% @customer_packages.each do |package| %>
        <tr>
          <td>
            <% if package.driver_id.nil? %>
            Ready for Pickup
            <% elsif package.driver_id && package.pick_up_time.nil? %>
            Accepted
            <% elsif package.pick_up_time && package.delivery_time.nil? %>
            Picked Up
            <% else package.delivery_time %>
              Delivered
              <!-- <%= package.delivery_time %> -->
            <% end %>
          </td>

          <td>
            <a href="/packages/<%= package.id %>">
              <%= package.title %>
            </a>
          </td>

          <td>
            <%= package.origin %>
          </td>

          <td>
            <%= package.destination %>
          </td>

        </tr>

        <% end %>
      </tbody>
      </table>


  <!-- <% @customer_packages.each do |package| %>
    <a href="/packages/<%= package.id %>">
    <div class="row">
      <div class="col l12">
        <div class="col l2">
          <p>
            <% if package.driver_id.nil? %>
            Ready for Pickup
            <% elsif package.driver_id && package.pick_up_time.nil? %>
            Accepted
            <% elsif package.pick_up_time && package.delivery_time.nil? %>
            Picked Up
            <% else package.delivery_time %>
              Delivered
              <!-- <%= package.delivery_time %> -->
            <!-- <% end %>
          </p>
        </div>
        <div class="col l4">
          <p>
            <%= package.title %>
          </p>
        </div>
        <div class="col l3">
          <p>
            <%= package.origin %>
          </p>
        </div>
        <div class="col l3">
          <p>
            <%= package.destination %>
          </p>
        </div>
      </div>
      <br/>
    </div>
    </a>
  <% end %> -->

<% elsif @current_user.type == 'Driver'%>
  <h1> Your Deliveries </h1>

  <% @driver_packages.each do |package| %>
    <a href="/packages/<%= package.id %>">
      <div>
        <p>
          <% if package.driver_id && package.pick_up_time.nil? %>
          Accepted
          <% else  package.pick_up_time && package.delivery_time.nil? %>
          Picked Up
          <% end %>
          <%= package.title %><%= package.origin %><%= package.destination %></p>
      </div>
    </a>
  <% end %>

  <script type="text/javascript">
    var map;
    var geocoder;
    // translate to json format the packages array
    var driver_packages_json = <%= @driver_packages.to_json;binding.pry %>;
    var past_driver_packages_json = <%= @past_driver_packages.to_json %>
    // init the map
    function initialize() {
      //create a new instance of geocoder
      geocoder = new google.maps.Geocoder();
      // create a lat and long object
      var latlng = new google.maps.LatLng(-34.397, 150.644);
      // set the map object options (both are required)
      var mapOptions = {
        zoom: 2,
        center: latlng
      };
      // create a new map object
      map = new google.maps.Map(document.getElementById("map"), mapOptions);
      codeAddress();
    }

    //
    function codeAddress() {
        // loop through each package in the array (in JSON format) and calculate for each the lat and long, assign a marker andadd the marker to the map
        driver_packages_json.forEach(function (a_pack_hash) {
          
          // give a an address as a string 
          geocoder.geocode( { 'address': a_pack_hash['origin']}, function(results, status) {
            
            // check the status of the geocoding. If true show location on the map
            if (status == google.maps.GeocoderStatus.OK) {
              // set center of map view 
              map.setCenter(results[0].geometry.location);
              // create a marker to go on the map at a given position
              var marker = new google.maps.Marker({
                  map: map,
                  position: results[0].geometry.location
              });
              // if geocoding did not work, show an alert
            } else {
              alert("Geocode was not successful for the following reason: " + status);
            }
          });
        });
      }
  </script>

  <div class="row">
    <div class="col s12 l12" style="height: 450px;">
      <div id="map"></div>
    </div>
  </div>
<% end %>
